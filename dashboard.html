<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wind Controller</title>

<!-- MQTT JS -->
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #001f3f, #003c74);
        height: 100vh;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    h1 {
        margin-bottom: 20px;
        font-size: 32px;
        font-weight: 700;
    }

    .grid {
        display: grid;
        grid-template-columns: repeat(3, 100px);
        grid-gap: 12px;
    }

    button {
        background: #0a84ff;
        border: none;
        padding: 15px;
        border-radius: 12px;
        color: white;
        font-size: 18px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
    }

    button:hover {
        background: #1aa3ff;
        transform: scale(1.05);
    }

    #status {
        margin-top: 20px;
        font-size: 18px;
        font-weight: bold;
        color: #c8e8ff;
    }
</style>
</head>

<body>
    <h1>Wind Direction Controller</h1>

    <div class="grid">
        <button onclick="sendDir('NW')">NW</button>
        <button onclick="sendDir('N')">N</button>
        <button onclick="sendDir('NE')">NE</button>

        <button onclick="sendDir('W')">W</button>
        <button onclick="sendDir('C')">‚Ä¢</button>
        <button onclick="sendDir('E')">E</button>

        <button onclick="sendDir('SW')">SW</button>
        <button onclick="sendDir('S')">S</button>
        <button onclick="sendDir('SE')">SE</button>
    </div>

    <div id="status">Connecting to MQTT...</div>

<script>
    // -----------------------------
    // MQTT CONFIGURATION
    // -----------------------------
    const host = "wss://5be7415cd7474f8f9d61534138d01818.s1.eu.hivemq.cloud:8884/mqtt";
    const username = "esp32user";
    const password = "Esp32user";

    const clientID = "wind-controller-" + Math.floor(Math.random() * 9999);

    const client = mqtt.connect(host, {
        clientId: clientID,
        username: username,
        password: password,
        clean: true,
        reconnectPeriod: 2000
    });

    const topic = "esp32/windDirection";

    // -----------------------------
    // MQTT EVENTS
    // -----------------------------
    client.on("connect", () => {
        document.getElementById("status").innerHTML = "‚úî Connected to MQTT";
    });

    client.on("error", (err) => {
        document.getElementById("status").innerHTML = "‚ùå Connection Error";
        console.error("MQTT Error:", err);
    });

    // -----------------------------
    // SEND WIND DIRECTION
    // -----------------------------
    function sendDir(direction) {
        client.publish(topic, direction, { qos: 1, retain: false });

        document.getElementById("status").innerHTML =
            "üì° Sent: <b>" + direction + "</b>";
    }
</script>
</body>
</html>
